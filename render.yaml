# Laniakea Protocol - Render Deployment Configuration
# All future updates to render.yaml will be synced automatically, which may change your costs.

services:
  # Main Web Application Service
  - type: web
    name: laniakea-protocol
    runtime: python
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      pip install -r requirements_minimal.txt
    startCommand: |
      python main.py --node-id laniakea-render-node --port $PORT
    healthCheckPath: /health
    envVars:
      # Python Configuration
      - key: PYTHON_VERSION
        value: 3.11
      - key: PYTHONUNBUFFERED
        value: "true"
      
      # Application Configuration
      - key: NODE_ID
        value: laniakea-render-node
      - key: PORT
        value: 10000
      - key: ENVIRONMENT
        value: production
      
      # Security Configuration
      - key: JWT_SECRET_KEY
        generateValue: true
      - key: ENCRYPTION_KEY
        generateValue: true
      
      # Database Configuration (if needed)
      - key: DATABASE_URL
        value: ""
      
      # External API Keys
      - key: OPENAI_API_KEY
        sync: false
      
      # Performance Settings
      - key: MAX_WORKERS
        value: "4"
      - key: WORKER_TIMEOUT
        value: "300"
      - key: MEMORY_LIMIT
        value: "512"

  # Background Worker for Blockchain Operations
  - type: worker
    name: laniakea-blockchain-worker
    runtime: python
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      pip install -r requirements_minimal.txt
    startCommand: |
      python main.py --node-id laniakea-worker-node --port $PORT
    envVars:
      # Python Configuration
      - key: PYTHON_VERSION
        value: 3.11
      - key: PYTHONUNBUFFERED
        value: "true"
      
      # Worker Configuration
      - key: NODE_ID
        value: laniakea-worker-node
      - key: WORKER_TYPE
        value: "background"
      - key: ENVIRONMENT
        value: production
      
      # Security Configuration
      - key: JWT_SECRET_KEY
        sync: false
      - key: ENCRYPTION_KEY
        sync: false
      
      # Performance Settings
      - key: WORKER_CONCURRENCY
        value: "2"
      - key: QUEUE_SIZE
        value: "1000"

  # Redis Service for Caching (Optional)
  - type: redis
    name: laniakea-cache
    plan: free
    ipAllowList: []
    envVars:
      - key: REDIS_PASSWORD
        generateValue: true

# Build and Deployment Optimization
build:
  dockerfilePath: ""
  dockerContext: .
  dockerBuildDirectory: ""

# Health Check Configuration
healthCheck:
  path: /health
  interval: 30
  timeout: 10
  gracePeriod: 60

# Scaling Configuration (for production)
autoscaling:
  enabled: true
  minInstances: 1
  maxInstances: 3
  targetCPUPercent: 70
  targetMemoryPercent: 80

# Networking Configuration
network:
  port: 10000
  httpPort: 80
  httpsPort: 443

# Environment-Specific Settings
environments:
  production:
    healthCheck:
      path: /health
      interval: 30
      timeout: 10
      gracePeriod: 60
  
  staging:
    healthCheck:
      path: /health
      interval: 60
      timeout: 15
      gracePeriod: 120

# Custom Domains (uncomment and configure as needed)
# domains:
#   - name: laniakea.yourdomain.com
#     type: primary

# Notification Settings (optional)
# notifications:
#   email:
#     - email: admin@yourdomain.com

# Resource Limits
resources:
  cpu: "0.5"
  memory: "512Mi"
  disk: "1Gi"

# Backup Configuration
backups:
  enabled: true
  retentionDays: 30
  encryption: true

# Security Headers
headers:
  - name: X-Frame-Options
    value: DENY
  - name: X-Content-Type-Options
    value: nosniff
  - name: X-XSS-Protection
    value: "1; mode=block"
  - name: Strict-Transport-Security
    value: "max-age=31536000; includeSubDomains"

# Rate Limiting
rateLimit:
  enabled: true
  requestsPerMinute: 100
  burstSize: 200

# Monitoring and Logging
monitoring:
  enabled: true
  logLevel: info
  metrics: true
  alerts: true

# Custom Start Scripts (if needed)
preDeployCommand: |
  echo "Pre-deployment checks..."
  python -m py_compile main.py
  echo "✅ Code compilation successful"

postDeployCommand: |
  echo "Post-deployment setup..."
  echo "✅ Laniakea Protocol deployed successfully"

# Error Handling
errorHandling:
  restartPolicy: always
  maxRetries: 3
  backoffDuration: 30

# Custom Health Check Script
healthCheckCommand: |
  python -c "
import requests
import sys
try:
    response = requests.get('http://localhost:$PORT/health', timeout=10)
    if response.status_code == 200:
        print('✅ Health check passed')
        sys.exit(0)
    else:
        print(f'❌ Health check failed: {response.status_code}')
        sys.exit(1)
except Exception as e:
    print(f'❌ Health check error: {e}')
    sys.exit(1)
"

# End of Render Configuration
# This configuration ensures complete and flawless deployment of Laniakea Protocol